---
import Layout from '@/layouts/Layout.astro';
import { EmpresaForm } from '@/components/sii/empresa-form';
import { ArrowLeft } from 'lucide-react';
import { empresasService } from '@/lib/sii-api';

const { id } = Astro.params;

// Obtener datos de la empresa de la API
const response = await empresasService.obtener(id!);
const empresaData = response.success ? response.data : null;

if (!empresaData) {
  return Astro.redirect('/admin/empresas');
}

// Transformar datos para el formulario
const empresa = {
  rut: empresaData.rut,
  razon_social: empresaData.razon_social,
  giro: empresaData.giro,
  direccion: empresaData.direccion,
  comuna: empresaData.comuna,
  ciudad: empresaData.ciudad,
  acteco: empresaData.acteco?.join(', ') || '',
  telefono: empresaData.telefono || '',
  email: empresaData.email || '',
  nro_resol: empresaData.nro_resol,
  fch_resol: empresaData.fch_resol,
  sii_ambiente: empresaData.sii_ambiente as 'CERTIFICACION' | 'PRODUCCION',
};
---

<Layout title="Editar Empresa">
  <div class="max-w-2xl">
    <a href={`/admin/empresas/${id}`} class="inline-flex items-center text-sm text-muted-foreground hover:text-foreground mb-6">
      <ArrowLeft class="mr-1 h-4 w-4" /> Volver al detalle
    </a>

    <p class="text-muted-foreground mb-6">
      Modifica los datos de la empresa.
    </p>

    <EmpresaForm initialData={empresa} empresaId={id} client:load />
  </div>
</Layout>
